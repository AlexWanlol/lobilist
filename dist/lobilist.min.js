Math.randomString=function(n){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;n>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},$(function(){var List=function($lobiList,options){this.$lobiList=$lobiList,this.$el=null,this.$options=options,this.$items=[],this.$globalOptions=$lobiList.$options;var $LIST,$HEADER,$TITLE,$FORM,$FOOTER,$BODY,me=this,_processItemData=function(item){return $.extend({},$.fn.lobiList.OPTIONS.itemOptions,item)},_init=function(){me.$options.id||(me.$options.id=Math.randomString(10));var $div=$("<div>",{id:me.$options.id,"class":"lobilist"});me.$options.defaultStyle&&$div.addClass(me.$options.defaultStyle),me.$el=$div,$HEADER=_createHeader(),$TITLE=_createTitle(),$BODY=_createBody(),$LIST=_createList(),options.items&&_createItems(options.items),$FORM=_createForm(),$BODY.append($LIST,$FORM),$FOOTER=_createFooter(),me.$globalOptions.sortable&&_enableSorting()},_createHeader=function(){var $header=$("<div>",{"class":"lobilist-header"}),$actions=$("<div>",{"class":"lobilist-actions"}).appendTo($header);return me.$options.controls&&me.$options.controls.length>0&&(me.$options.controls.indexOf("styleChange")>-1&&$actions.append(_createDropdownForStyleChange()),me.$options.controls.indexOf("edit")>-1&&($actions.append(_createEditTitleButton()),$actions.append(_createFinishTitleEditing()),$actions.append(_createCancelTitleEditing())),me.$options.controls.indexOf("add")>-1&&$actions.append(_createAddNewButton()),me.$options.controls.indexOf("remove")>-1&&$actions.append(_createCloseButton())),me.$el.append($header),$header},_createTitle=function(){var $title=$("<div>",{"class":"lobilist-title",html:me.$options.title}).appendTo($HEADER);return me.$options.controls&&me.$options.controls.indexOf("edit")>-1&&$title.on("dblclick",function(){me.startTitleEditing()}),$title},_createBody=function(){return $("<div>",{"class":"lobilist-body"}).appendTo(me.$el)},_createForm=function(){var $form=$("<form>",{"class":"lobilist-add-todo-form hide"});$("<input>",{type:"hidden",name:"id"}).appendTo($form),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"title","class":"form-control",placeholder:"TODO title"})).appendTo($form),$("<div>",{"class":"form-group"}).append($("<textarea>",{rows:"2",name:"description","class":"form-control",placeholder:"TODO description"})).appendTo($form),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"dueDate","class":"form-control",placeholder:"Due Date"})).appendTo($form);var $ft=$("<div>",{"class":"lobilist-form-footer"});return $("<button>",{"class":"btn btn-primary btn-sm btn-add-todo",html:"Add"}).appendTo($ft),$("<button>",{type:"button","class":"btn btn-default btn-sm btn-discard-todo",html:'<i class="glyphicon glyphicon-remove-circle"></i>'}).click(function(){$FORM.addClass("hide"),$FOOTER.removeClass("hide")}).appendTo($ft),$ft.appendTo($form),_formHandler($form),me.$el.append($form),$form},_formHandler=function($form){$form.on("submit",function(ev){ev.preventDefault(),_submitForm()})},_submitForm=function(){return $FORM[0].title.value?(me.saveOrUpdateItem({id:$FORM[0].id.value,title:$FORM[0].title.value,description:$FORM[0].description.value,dueDate:$FORM[0].dueDate.value}),$FORM.addClass("hide"),void $FOOTER.removeClass("hide")):void _showFormError("title","Title can not be empty")},_createFooter=function(){var $footer=$("<div>",{"class":"lobilist-footer"});return $("<button>",{type:"button","class":"btn-link btn-show-form",html:"Add new"}).click(function(){_resetForm(),$FORM.removeClass("hide"),$FOOTER.addClass("hide")}).appendTo($footer),me.$el.append($footer),$footer},_createList=function(){var $list=$("<ul>",{"class":"lobilist-items"});return me.$el.append($list),$list},_createItems=function(items){for(var i=0;i<items.length;i++)_addItem(items[i])},_addItem=function(item){item.id||(item.id=me.$lobiList.getNextId()),item=_processItemData(item),_addItemToList(item)},_createCheckbox=function(){var $item=$("<input>",{type:"checkbox"});$item.change(function(){$item.closest(".lobilist-item").toggleClass("item-done")});var $label=$("<label>",{"class":"checkbox-inline lobilist-check"}).append($item);return me.$options.useLobicheck&&($label.addClass("lobicheck").addClass(me.$options.lobicheckClass),$label.append("<i></i>")),$label},_createDropdownForStyleChange=function(){for(var $dropdown=$("<div>",{"class":"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown","class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),$menu=$("<div>",{"class":"dropdown-menu dropdown-menu-right"}).appendTo($dropdown),i=0;i<$.fn.lobiList.OPTIONS.listStyles.length;i++){var st=$.fn.lobiList.OPTIONS.listStyles[i];$('<div class="'+st+'"></div>').on("mousedown",function(ev){ev.stopPropagation()}).click(function(){me.$el.removeClass($.fn.lobiList.OPTIONS.listStyles.join(" ")).addClass(this.className)}).appendTo($menu)}return $dropdown},_createEditTitleButton=function(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-edit"></i>'});return $btn.click(function(){me.startTitleEditing()}),$btn},_createAddNewButton=function(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-plus"></i>'});return $btn.click(function(){var list=me.$lobiList.addList();list.startTitleEditing()}),$btn},_createCloseButton=function(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-remove"></i>'});return $btn.click(function(){me.remove()}),$btn},_createFinishTitleEditing=function(){var $btn=$("<button>",{"class":"btn btn-default btn-xs btn-finish-title-editing",html:'<i class="glyphicon glyphicon-ok-circle"></i>'});return $btn.click(function(){me.finishTitleEditing()}),$btn},_createCancelTitleEditing=function(){var $btn=$("<button>",{"class":"btn btn-default btn-xs btn-cancel-title-editing",html:'<i class="glyphicon glyphicon-remove-circle"></i>'});return $btn.click(function(){me.cancelTitleEditing()}),$btn},_createInput=function(){var input=$("<input>",{type:"text","class":"form-control"});return input.on("keyup",function(ev){13===ev.which&&me.finishTitleEditing()}),input},_showFormError=function(field,error){var $fGroup=$FORM.find('[name="'+field+'"]').closest(".form-group").addClass("has-error");$fGroup.find(".help-block").remove(),$fGroup.append($("<span>",{"class":"help-block",html:error}))},_resetForm=function(){$FORM[0].reset(),$FORM[0].id.value="",$FORM.find(".form-group").removeClass("has-error").find(".help-block").remove()},_enableSorting=function(){me.$el.find(".lobilist-items").sortable({connectWith:".lobilist .lobilist-items",items:".lobilist-item",handle:".drag-handler",cursor:"move",placeholder:"lobilist-item-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70})},_addItemToList=function(item){var $li=$("<li>",{"data-id":item.id,"class":"lobilist-item"});return $li.append($("<div>",{"class":"lobilist-item-title",html:item.title})),item.description&&$li.append($("<div>",{"class":"lobilist-item-description",html:item.description})),item.dueDate&&$li.append($("<div>",{"class":"lobilist-item-duedate",html:item.dueDate})),$li=_addItemControls($li),item.done&&($li.find("input[type=checkbox]").prop("checked",!0),$li.addClass("item-done")),$li.data("lobiListItem",item),$LIST.append($li),$li},_addItemControls=function($li){me.$options.useCheckboxes&&$li.append(_createCheckbox());var $itemControlsDiv=$("<div>",{"class":"todo-actions"}).appendTo($li);return me.$options.editItemButton&&$itemControlsDiv.append($("<div>",{"class":"edit-todo todo-action",html:'<i class="glyphicon glyphicon-pencil"></i>'}).click(function(){me.editItem($(this).closest("li").data("id"))})),me.$options.removeItemButton&&$itemControlsDiv.append($("<div>",{"class":"delete-todo todo-action",html:'<i class="glyphicon glyphicon-remove"></i>'}).click(function(){me.deleteItem($(this).closest("li").data("lobiListItem"))})),$li.append($("<div>",{"class":"drag-handler"})),$li},_updateItemInList=function(item){var $li=me.$lobiList.$el.find('li[data-id="'+item.id+'"]');$li.find("input[type=checkbox]").prop("checked",item.done),$li.find(".lobilist-item-title").html(item.title),$li.find(".lobilist-item-description").remove(),$li.find(".lobilist-item-duedate").remove(),item.description&&$li.append('<div class="lobilist-item-description">'+item.description+"</div>"),item.dueDate&&$li.append('<div class="lobilist-item-duedate">'+item.dueDate+"</div>"),$li.data("lobiListItem",item)};this.addItem=function(item){me.$options.onItemAdd&&me.$options.onItemAdd(me,item);var saved=!1;return item=_processItemData(item),me.$globalOptions.actions.insert?$.ajax(me.$globalOptions.actions.insert,{data:item,method:"POST",async:!1}).done(function(res){res.success?(saved=!0,item.id=res.id):Lobibox.notify("error",{msg:res.msg||"Error occured"})}):(saved=!0,item.id=me.$lobiList.getNextId()),saved&&_addItemToList(item),me.$options.afterItemAdd&&me.$options.afterItemAdd(me,item),me},this.updateItem=function(item){me.$options.onItemUpdate&&me.$options.onItemUpdate(me,item);var saved=!1;return me.$globalOptions.actions.update?$.ajax(me.$globalOptions.actions.update,{data:item,method:"POST",async:!1}).done(function(res){res.success?saved=!0:Lobibox.notify("error",{msg:res.msg||"Error occured"})}):saved=!0,saved&&_updateItemInList(item),me.$options.afterItemUpdate&&me.$options.afterItemUpdate(me,item),me},this.deleteItem=function(item,discardEvent){var check=!0;if(!discardEvent&&me.$options.onItemDelete&&(check=me.$options.onItemDelete(me,item)),check===!1)return me;var deleted=!1;return me.$globalOptions.actions["delete"]?$.ajax(me.$globalOptions.actions["delete"],{data:item,method:"POST",async:!1}).done(function(res){res.success?deleted=!0:Lobibox.notify("error",{msg:res.msg||"Error occured"})}):deleted=!0,deleted&&me.$lobiList.$el.find("li[data-id="+item.id+"]").remove(),me.$options.afterItemDelete&&me.$options.afterItemDelete(me,item),me},this.saveOrUpdateItem=function(item){return item.id?me.updateItem(item):me.addItem(item),me},this.startTitleEditing=function(){var input=_createInput();return $TITLE.attr("data-old-title",$TITLE.html()),input.val($TITLE.html()),input.insertAfter($TITLE),$TITLE.addClass("hide"),$HEADER.addClass("title-editing"),input[0].focus(),input[0].select(),me},this.finishTitleEditing=function(){var $input=$HEADER.find("input");return $TITLE.html($input.val()).removeClass("hide").removeAttr("data-old-title"),$input.remove(),$HEADER.removeClass("title-editing"),me},this.cancelTitleEditing=function(){var $input=$HEADER.find("input");return 0===$input.length?me:($TITLE.html($TITLE.attr("data-old-title")).removeClass("hide"),$input.remove(),$HEADER.removeClass("title-editing"),me)},this.remove=function(discardEvent){var check=!0;return!discardEvent&&me.$options.beforeListRemove&&(check=me.$options.beforeListRemove(me)),check===!1?me:(me.$lobiList.$lists.splice(me.$el.index(),1),me.$el.remove(),me.$options.afterListRemove&&me.$options.afterListRemove(me),me)},this.editItem=function(id){var $item=me.$lobiList.$el.find("li[data-id="+id+"]"),$form=$item.closest(".lobilist").find(".lobilist-add-todo-form"),$footer=$item.closest(".lobilist").find(".lobilist-footer");return $form.removeClass("hide"),$footer.addClass("hide"),$form[0].id.value=$item.attr("data-id"),$form[0].title.value=$item.find(".lobilist-item-title").html(),$form[0].description.value=$item.find(".lobilist-item-description").html()||"",$form[0].dueDate.value=$item.find(".lobilist-item-duedate").html()||"",me},_init()},LobiList=function($el,options){this.$el=null,this.$lists=[],this.$options={};var me=this,$nextId=1,_processInput=function(options){return options=$.extend({},$.fn.lobiList.DEFAULT_OPTIONS,options),options.actions.load&&$.ajax(options.actions.load,{async:!1}).done(function(res){options.lists=res.lists}),options},_processListOptions=function(listOptions){listOptions=$.extend({},$.fn.lobiList.OPTIONS.listsOptions,listOptions);for(var processOptions=["useCheckboxes","useLobicheck","lobicheckClass","removeItemButton","editItemButton","sortable","controls","defaultStyle","beforeListAdd","beforeListRemove","afterListRemove","onItemAdd","afterItemAdd","onItemUpdate","afterItemUpdate","onItemDelete","afterItemDelete"],i=0;i<processOptions.length;i++)void 0===listOptions[processOptions[i]]&&(listOptions[processOptions[i]]=me.$options[processOptions[i]]);return listOptions},_init=function(){me.$el.addClass("lobilists"),_createLists(),me.$options.sortable&&me.$el.sortable({items:".lobilist",handle:".lobilist-header",cursor:"move",placeholder:"lobilist-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70}),me.$options.init&&me.$options.init(me)},_createLists=function(){for(var i=0;i<me.$options.lists.length;i++)me.addList(me.$options.lists[i])};this.addList=function(options){var list;return options instanceof List?list=options:(options=_processListOptions(options),list=new List(me,options)),me.$lists.push(list),me.$el.append(list.$el),list.$el.data("lobiList",list),me.$options.beforeListAdd&&me.$options.beforeListAdd(me),list},this.getNextId=function(){return $nextId++},this.$el=$el,this.$options=_processInput(options),_init()};$.fn.lobiList=function(option){var ret,args=arguments;return this.each(function(){var $this=$(this),data=$this.data("lobiList"),options="object"==typeof option&&option;data||$this.data("lobiList",data=new LobiList($this,options)),"string"==typeof option&&(args=Array.prototype.slice.call(args,1),ret=data[option].apply(data,args))})},$.fn.lobiList.OPTIONS={listStyles:["lobilist-default","lobilist-danger","lobilist-success","lobilist-warning","lobilist-info","lobilist-primary"],listsOptions:{id:!1,title:"",items:[]},itemOptions:{id:!1,title:"",description:"",dueDate:"",done:!1}},$.fn.lobiList.DEFAULT_OPTIONS={lists:[],actions:{load:"",update:"",insert:"","delete":""},useCheckboxes:!0,useLobicheck:!0,lobicheckClass:"lobicheck-info lobicheck-inversed",removeItemButton:!0,editItemButton:!0,sortable:!0,controls:["edit","add","remove","styleChange"],defaultStyle:"lobilist-default",init:null,beforeDestroy:null,afterDestroy:null,beforeListAdd:null,afterListAdd:null,beforeListRemove:null,afterListRemove:null,beforeItemAdd:null,afterItemAdd:null,beforeItemUpdate:null,afterItemUpdate:null,beforeItemDelete:null,afterItemDelete:null,beforeListDrop:null,afterListDrop:null,beforeItemDrop:null,afterItemDrop:null,beforeMarkAsDone:null,afterMarkAsDone:null,beforeUnmarkAsDone:null,afterUnmarkAsDone:null}});